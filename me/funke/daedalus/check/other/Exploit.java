package me.funke.daedalus.check.other;

import me.funke.daedalus.check.Check;
import me.funke.daedalus.utils.Chance;
import org.bukkit.Material;
import org.bukkit.enchantments.Enchantment;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.player.PlayerEditBookEvent;
import org.bukkit.event.player.PlayerInteractEvent;
import org.bukkit.inventory.ItemStack;
import org.bukkit.inventory.meta.BookMeta;

public class Exploit extends Check {

    public Exploit(me.funke.daedalus.Daedalus Daedalus) {
        super("Exploit", "Exploit", Daedalus);

        setEnabled(true);
        setBannable(false);
        setMaxViolations(1);
    }

    @EventHandler
    public void onDamage(PlayerInteractEvent event) {
        Player attacker = event.getPlayer();
        ItemStack is = attacker.getItemInHand();
        if (is == null) {
            return;
        }
        if ((is.getType() != Material.BOOK_AND_QUILL) && (is.getType() != Material.WRITTEN_BOOK)) {
            return;
        }
        if (is.getEnchantments().size() > 0) {
            for (Enchantment ench : is.getEnchantments().keySet()) {
                is.removeEnchantment(ench);
            }

            event.setCancelled(true);
            getDaedalus().logCheat(this, attacker, "Book and Quill Exploit", Chance.LIKELY);
            attacker.getInventory().removeItem(is);
        }
    }

    @EventHandler
    public void onEdit(PlayerEditBookEvent event) {
        BookMeta book = event.getNewBookMeta();
        if (book.getEnchants().size() > 0) {
            event.setCancelled(true);
            event.getPlayer().getInventory().remove(Material.BOOK_AND_QUILL);
            getDaedalus().logCheat(this, event.getPlayer(), "Book and Quill Exploit", Chance.LIKELY);
        }
    }

}
